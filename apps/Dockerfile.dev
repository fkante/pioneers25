FROM node:24.2.0-alpine

# Install pnpm
RUN corepack enable && corepack prepare pnpm@10.11.0 --activate

# Install netcat for healthchecks
RUN apk add --no-cache netcat-openbsd

# Create app directory
WORKDIR /home/node

# Set user
USER node

# Copy package files for workspace
COPY --chown=node:node package.json pnpm-lock.yaml pnpm-workspace.yaml ./

# Copy package.json files for all workspaces
COPY --chown=node:node packages/core/package.json ./packages/core/
COPY --chown=node:node apps/backend/package.json ./apps/backend/
COPY --chown=node:node apps/frontend/package.json ./apps/frontend/

# Install all dependencies
RUN pnpm install --frozen-lockfile

# Expose ports
EXPOSE 3000 5173

# Default command (will be overridden by docker-compose)
CMD ["pnpm", "dev"]

